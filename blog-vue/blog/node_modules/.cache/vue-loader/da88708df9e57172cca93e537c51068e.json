{"remainingRequest":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!B:\\GitCode\\MyBlog\\blog-vue\\blog\\src\\components\\model\\EmailModel.vue?vue&type=script&lang=js&","dependencies":[{"path":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\src\\components\\model\\EmailModel.vue","mtime":1678087997345},{"path":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678087981122},{"path":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\node_modules\\babel-loader\\lib\\index.js","mtime":1678087980232},{"path":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678087981122},{"path":"B:\\GitCode\\MyBlog\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js","mtime":1678087994067}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGE6IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiB7DQogICAgICBlbWFpbDogdGhpcy4kc3RvcmUuc3RhdGUuZW1haWwsDQogICAgICBjb2RlOiAiIiwNCiAgICAgIGZsYWc6IHRydWUsDQogICAgICBjb2RlTXNnOiAi5Y+R6YCBIiwNCiAgICAgIHRpbWU6IDYwLA0KICAgICAgc2hvdzogZmFsc2UNCiAgICB9Ow0KICB9LA0KICBtZXRob2RzOiB7DQogICAgc2VuZENvZGUoKSB7DQogICAgICBjb25zdCB0aGF0ID0gdGhpczsNCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZg0KICAgICAgdmFyIGNhcHRjaGEgPSBuZXcgVGVuY2VudENhcHRjaGEodGhpcy5jb25maWcuVEVOQ0VOVF9DQVBUQ0hBLCBmdW5jdGlvbigNCiAgICAgICAgcmVzDQogICAgICApIHsNCiAgICAgICAgaWYgKHJlcy5yZXQgPT09IDApIHsNCiAgICAgICAgICAvL+WPkemAgemCruS7tg0KICAgICAgICAgIHRoYXQuY291bnREb3duKCk7DQogICAgICAgICAgdGhhdC5heGlvcw0KICAgICAgICAgICAgLmdldCgiL2FwaS91c2Vycy9jb2RlIiwgew0KICAgICAgICAgICAgICBwYXJhbXM6IHsgdXNlcm5hbWU6IHRoYXQuZW1haWwgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4gew0KICAgICAgICAgICAgICBpZiAoZGF0YS5mbGFnKSB7DQogICAgICAgICAgICAgICAgdGhhdC4kdG9hc3QoeyB0eXBlOiAic3VjY2VzcyIsIG1lc3NhZ2U6IGRhdGEubWVzc2FnZSB9KTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGF0LiR0b2FzdCh7IHR5cGU6ICJlcnJvciIsIG1lc3NhZ2U6IGRhdGEubWVzc2FnZSB9KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgLy8g5pi+56S66aqM6K+B56CBDQogICAgICBjYXB0Y2hhLnNob3coKTsNCiAgICB9LA0KICAgIGNvdW50RG93bigpIHsNCiAgICAgIHRoaXMuZmxhZyA9IHRydWU7DQogICAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICB0aGlzLnRpbWUtLTsNCiAgICAgICAgdGhpcy5jb2RlTXNnID0gdGhpcy50aW1lICsgInMiOw0KICAgICAgICBpZiAodGhpcy50aW1lIDw9IDApIHsNCiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpOw0KICAgICAgICAgIHRoaXMuY29kZU1zZyA9ICLlj5HpgIEiOw0KICAgICAgICAgIHRoaXMudGltZSA9IDYwOw0KICAgICAgICAgIHRoaXMuZmxhZyA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9LCAxMDAwKTsNCiAgICB9LA0KICAgIHNhdmVVc2VyRW1haWwoKSB7DQogICAgICB2YXIgcmVnID0gL15bQS1aYS16MC05XHU0ZTAwLVx1OWZhNV0rQFthLXpBLVowLTlfLV0rKFwuW2EtekEtWjAtOV8tXSspKyQvOw0KICAgICAgaWYgKCFyZWcudGVzdCh0aGlzLmVtYWlsKSkgew0KICAgICAgICB0aGlzLiR0b2FzdCh7IHR5cGU6ICJlcnJvciIsIG1lc3NhZ2U6ICLpgq7nrrHmoLzlvI/kuI3mraPnoa4iIH0pOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgICBpZiAodGhpcy5jb2RlLnRyaW0oKS5sZW5ndGggIT0gNikgew0KICAgICAgICB0aGlzLiR0b2FzdCh7IHR5cGU6ICJlcnJvciIsIG1lc3NhZ2U6ICLor7fovpPlhaU25L2N6aqM6K+B56CBIiB9KTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgY29uc3QgdXNlciA9IHsNCiAgICAgICAgZW1haWw6IHRoaXMuZW1haWwsDQogICAgICAgIGNvZGU6IHRoaXMuY29kZQ0KICAgICAgfTsNCiAgICAgIHRoaXMuYXhpb3MucG9zdCgiL2FwaS91c2Vycy9lbWFpbCIsIHVzZXIpLnRoZW4oKHsgZGF0YSB9KSA9PiB7DQogICAgICAgIGlmIChkYXRhLmZsYWcpIHsNCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoInNhdmVFbWFpbCIsIHRoaXMuZW1haWwpOw0KICAgICAgICAgIHRoaXMuZW1haWwgPSAiIjsNCiAgICAgICAgICB0aGlzLmNvZGUgPSAiIjsNCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoImNsb3NlTW9kZWwiKTsNCiAgICAgICAgICB0aGlzLiR0b2FzdCh7IHR5cGU6ICJzdWNjZXNzIiwgbWVzc2FnZTogZGF0YS5tZXNzYWdlIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuJHRvYXN0KHsgdHlwZTogImVycm9yIiwgbWVzc2FnZTogZGF0YS5tZXNzYWdlIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgZW1haWxGbGFnOiB7DQogICAgICBzZXQodmFsdWUpIHsNCiAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuZW1haWxGbGFnID0gdmFsdWU7DQogICAgICB9LA0KICAgICAgZ2V0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuZW1haWxGbGFnOw0KICAgICAgfQ0KICAgIH0sDQogICAgaXNNb2JpbGUoKSB7DQogICAgICBjb25zdCBjbGllbnRXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsNCiAgICAgIGlmIChjbGllbnRXaWR0aCA+IDk2MCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgZW1haWwodmFsdWUpIHsNCiAgICAgIHZhciByZWcgPSAvXltBLVphLXowLTlcdTRlMDAtXHU5ZmE1XStAW2EtekEtWjAtOV8tXSsoXC5bYS16QS1aMC05Xy1dKykrJC87DQogICAgICBpZiAocmVnLnRlc3QodmFsdWUpKSB7DQogICAgICAgIHRoaXMuZmxhZyA9IGZhbHNlOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5mbGFnID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["EmailModel.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EmailModel.vue","sourceRoot":"src/components/model","sourcesContent":["<template>\r\n  <v-dialog v-model=\"emailFlag\" :fullscreen=\"isMobile\" max-width=\"460\">\r\n    <v-card class=\"login-container\" style=\"border-radius:4px\">\r\n      <v-icon class=\"float-right\" @click=\"emailFlag = false\">\r\n        mdi-close\r\n      </v-icon>\r\n      <div class=\"login-wrapper\">\r\n        <!-- 用户名 -->\r\n        <v-text-field\r\n          v-model=\"email\"\r\n          label=\"邮箱号\"\r\n          placeholder=\"请输入您的邮箱号\"\r\n          clearable\r\n          @keyup.enter=\"register\"\r\n        />\r\n        <!-- 验证码 -->\r\n        <div class=\"mt-7 send-wrapper\">\r\n          <v-text-field\r\n            maxlength=\"6\"\r\n            v-model=\"code\"\r\n            label=\"验证码\"\r\n            placeholder=\"请输入6位验证码\"\r\n            @keyup.enter=\"register\"\r\n          />\r\n          <v-btn text small :disabled=\"flag\" @click=\"sendCode\">\r\n            {{ codeMsg }}\r\n          </v-btn>\r\n        </div>\r\n        <!-- 按钮 -->\r\n        <v-btn\r\n          class=\"mt-7\"\r\n          block\r\n          color=\"blue\"\r\n          style=\"color:#fff\"\r\n          @click=\"saveUserEmail\"\r\n        >\r\n          绑定\r\n        </v-btn>\r\n      </div>\r\n    </v-card>\r\n  </v-dialog>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data: function() {\r\n    return {\r\n      email: this.$store.state.email,\r\n      code: \"\",\r\n      flag: true,\r\n      codeMsg: \"发送\",\r\n      time: 60,\r\n      show: false\r\n    };\r\n  },\r\n  methods: {\r\n    sendCode() {\r\n      const that = this;\r\n      // eslint-disable-next-line no-undef\r\n      var captcha = new TencentCaptcha(this.config.TENCENT_CAPTCHA, function(\r\n        res\r\n      ) {\r\n        if (res.ret === 0) {\r\n          //发送邮件\r\n          that.countDown();\r\n          that.axios\r\n            .get(\"/api/users/code\", {\r\n              params: { username: that.email }\r\n            })\r\n            .then(({ data }) => {\r\n              if (data.flag) {\r\n                that.$toast({ type: \"success\", message: data.message });\r\n              } else {\r\n                that.$toast({ type: \"error\", message: data.message });\r\n              }\r\n            });\r\n        }\r\n      });\r\n      // 显示验证码\r\n      captcha.show();\r\n    },\r\n    countDown() {\r\n      this.flag = true;\r\n      this.timer = setInterval(() => {\r\n        this.time--;\r\n        this.codeMsg = this.time + \"s\";\r\n        if (this.time <= 0) {\r\n          clearInterval(this.timer);\r\n          this.codeMsg = \"发送\";\r\n          this.time = 60;\r\n          this.flag = false;\r\n        }\r\n      }, 1000);\r\n    },\r\n    saveUserEmail() {\r\n      var reg = /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/;\r\n      if (!reg.test(this.email)) {\r\n        this.$toast({ type: \"error\", message: \"邮箱格式不正确\" });\r\n        return false;\r\n      }\r\n      if (this.code.trim().length != 6) {\r\n        this.$toast({ type: \"error\", message: \"请输入6位验证码\" });\r\n        return false;\r\n      }\r\n      const user = {\r\n        email: this.email,\r\n        code: this.code\r\n      };\r\n      this.axios.post(\"/api/users/email\", user).then(({ data }) => {\r\n        if (data.flag) {\r\n          this.$store.commit(\"saveEmail\", this.email);\r\n          this.email = \"\";\r\n          this.code = \"\";\r\n          this.$store.commit(\"closeModel\");\r\n          this.$toast({ type: \"success\", message: data.message });\r\n        } else {\r\n          this.$toast({ type: \"error\", message: data.message });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  computed: {\r\n    emailFlag: {\r\n      set(value) {\r\n        this.$store.state.emailFlag = value;\r\n      },\r\n      get() {\r\n        return this.$store.state.emailFlag;\r\n      }\r\n    },\r\n    isMobile() {\r\n      const clientWidth = document.documentElement.clientWidth;\r\n      if (clientWidth > 960) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n  },\r\n  watch: {\r\n    email(value) {\r\n      var reg = /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/;\r\n      if (reg.test(value)) {\r\n        this.flag = false;\r\n      } else {\r\n        this.flag = true;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@media (min-width: 760px) {\r\n  .login-container {\r\n    padding: 1rem;\r\n    border-radius: 4px;\r\n    height: 400px;\r\n  }\r\n}\r\n</style>\r\n"]}]}